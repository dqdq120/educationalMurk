<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Word Details</title>
  <style>
    body {
      font-family: "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(to bottom right, #eef3ff, #d8e1ff);
      color: #222;
      margin: 0;
      padding: 40px;
    }

    .container {
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    h1 {
      color: #2a4b9b;
      text-align: center;
      margin-bottom: 10px;
    }

    h2 {
      color: #333;
      margin-top: 25px;
    }

    .meaning {
      margin-bottom: 15px;
    }

    .example {
      font-style: italic;
      color: #555;
    }

    button {
      background: #2a4b9b;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 20px;
      transition: background 0.2s;
    }

    button:hover {
      background: #1e3580;
    }

    ul {
      padding-left: 20px;
    }

    li {
      margin: 5px 0;
    }

    .card {
      background: #f9f9ff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .affix-btn {
      background: #e0e4ff;
      color: #2a4b9b;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      margin: 5px 5px 0 0;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .affix-btn:hover {
      background: #c9d0ff;
      transform: scale(1.05);
    }

    .ai-buttons {
      text-align: center;
      margin-bottom: 20px;
    }

    .ai-buttons .affix-btn {
      background: #d0dcff;
    }

    .ai-buttons .affix-btn:hover {
      background: #b8c8ff;
    }
    .copilot-btn {
      background: #d0f0ff;
      color: #2a4b9b;
      width: 50%;
    }
    .copilot-btn:hover {
      background: #2a4b9b;
      color: #ffffff;
    }
  </style>
</head>
<body>

  <div class="container">
    <button onclick="goBack()">‚Üê Back</button>
    <h1 id="wordTitle">Loading...</h1>

    

    <div id="wordDetails">Fetching details... </div>
  </div>

  <script>
    function goBack() {
      window.history.back();
    }

    const word = localStorage.getItem("selectedWord");
    const title = document.getElementById("wordTitle");
    const details = document.getElementById("wordDetails");

    if (!word) {
      title.textContent = "No word selected";
      details.textContent = "Please go back and choose a word.";
    } else {
      title.textContent = word;
      loadWordDetails(word);
    }

    async function loadWordDetails(word) {
      details.innerHTML = "<p>Loading word details...</p>";

      let localData = null;
      let dictData = null;

      // Fetch local word data with error handling
      try {
        const localResponse = await fetch(`../merged_words/${word[0]}.json`);
        if (localResponse.ok) {
          const jsonData = await localResponse.json();
          localData = jsonData.find(entry => entry.word.toLowerCase() === word.toLowerCase()) || null;
        }
      } catch (e) {
        console.warn("No local file found for:", word);
      }

      // Fetch dictionary API info with error handling
      try {
        const response = await fetch(`https://freedictionaryapi.com/api/v1/entries/en/${encodeURIComponent(word)}`);
        if (response.ok) {
          dictData = await response.json();
        }
      } catch (e) {
        console.error('Dictionary API fetch error:', e);
      }

      const copilotBtnHTML = `<div class="ai-buttons">
                                <button class="card copilot-btn" style="background-image: url('icons8-microsoft-copilot-96.png');background-repeat: no-repeat;background-position: calc(100% - 2px);background-size: contain;" onclick="askCopilot()">Ask Copilot &nbsp;&nbsp;&nbsp;&nbsp;</button>
                              </div>`;

      if (!dictData || !dictData.entries || dictData.entries.length === 0) {
        details.innerHTML = copilotBtnHTML;
        return;
      }

      details.innerHTML = "";

      // Pronunciation from first entry
      const firstEntry = dictData.entries[0];
      if (firstEntry.pronunciations && firstEntry.pronunciations.length > 0) {
        details.innerHTML += `<p><strong>Pronunciation:</strong> ${firstEntry.pronunciations[0].text}</p>`;
      }

      // Add main meanings with examples
      dictData.entries.forEach(entry => {
        let posContent = `<h2>${entry.partOfSpeech}</h2>`;
        if (entry.senses && entry.senses.length > 0) {
          entry.senses.forEach(sense => {
            posContent += `
              <p><strong>Definition:</strong> ${sense.definition}</p>
              ${sense.examples && sense.examples.length > 0 ? `<p class="example">Example: ${sense.examples[0]}</p>` : ""}
            `;
          });
        }
        details.innerHTML += `<div class="card">${posContent}</div>`;
      });

      // Add prefixes and suffixes from local data
      if (localData) {
        if (localData.prefixes && localData.prefixes.length > 0) {
          details.innerHTML += `
            <div class="card">
              <h2>Prefixes</h2>
              ${localData.prefixes.map(p => `<button class="affix-btn" onclick="openPrefix('${p.replace(/[-]/g, "")}')">${p}</button>`).join("")}
            </div>
          `;
        }

        if (localData.suffixes && localData.suffixes.length > 0) {
          details.innerHTML += `
            <div class="card">
              <h2>Suffixes</h2>
              ${localData.suffixes.map(s => `<button class="affix-btn" onclick="openSufffix('${s.replace(/[-]/g, "")}')">${s}</button>`).join("")}
            </div>
          `;
        }

        if (localData.examples && localData.examples.length > 0) {
          details.innerHTML += `
            <div class="card">
              <h2>Extra Examples</h2>
              <ul>${localData.examples.map(e => `<li>${e}</li>`).join("")}</ul>
            </div>
          `;
        }
      }

      details.innerHTML += copilotBtnHTML;
    }

    // üîπ When user clicks a prefix or suffix button
    function openPrefix(prefix) {
      localStorage.setItem("selectedWord", prefix + word);
      window.location.assign("wordPreview.html");
    }

    function openSufffix(suffix) {
      localStorage.setItem("selectedWord", word + suffix);
      window.location.assign("wordPreview.html");
    }

    // üîπ Ask ChatGPT or Copilot about the word
    function askChatGPT() {
      const prompt = encodeURIComponent(`Explain the meaning or usage of the word "${word}" in simple terms.`);
      window.open(`https://chat.openai.com/?q=${prompt}`, "_blank");
    }

    function askCopilot() {
      const prompt = encodeURIComponent(`Explain the meaning or usage of the word "${word}" in simple terms.`);
      window.open(`https://copilot.microsoft.com/?q=${prompt}`, "_blank");
    }
  </script>

</body>
</html>